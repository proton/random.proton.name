<!DOCTYPE html>
<html>

<head>
    <title>Random number generator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" type ="text/css" href="styles.css">
</head>

<body>
    <table id="prev-inputs" class="prev-list prev-list-inputs" reversed="reversed"></table>
    <div class="wrapper">
        <p><label>Min</label><input type="number" value="1" id="min-input" /></p>
        <p><label>Max</label><input type="number" value="9" id="max-input" /></p>
        <button id="generate-btn">Generate!</button>
        <p><span id="result-text"></span></p>
    </div>
    <table id="prev-results" class="prev-list prev-list-results" reversed="reversed"></table>

    <ul class="other-web-sites"></ul>
    <script type="text/javascript" src="https://proton.name/other-links.js"></script>

    <script>
        const localStorageKey = 'prevResults'

        const minInput = document.getElementById('min-input')
        const maxInput = document.getElementById('max-input')
        const generateBtn = document.getElementById('generate-btn')
        const resultText = document.getElementById('result-text')

        const prevInputsList = document.getElementById('prev-inputs')
        const prevResultsList = document.getElementById('prev-results')

        const prevResults = JSON.parse(localStorage.getItem(localStorageKey)) || []

        if (prevResults.length) {
            const lastResult = prevResults[prevResults.length - 1]
            minInput.value = lastResult.min
            maxInput.value = lastResult.max
        }

        const inputToElement = result => `<tr data-min=${result.min} data-max=${result.max}><td>${result.min}</td><td>⬌</td><td>${result.max}</td></tr>`
        const resultToElement = result => `<tr data-min=${result.min} data-max=${result.max} data-result=${result.result}><td>${result.min}</td><td>⬌</td><td>${result.max}</td><td> = </td><td>${result.result}</td></tr>`

        const renderPrevs = function () {
            prevInputsList.innerHTML = [...new Set(prevResults.map(inputToElement))].join('')
            prevResultsList.innerHTML = prevResults.map(resultToElement).join('')
        }

        const rand = (min, max) => Math.floor(Math.random() * (max - min + 1) + min)

        const loadResult = function(event) {
            let el = event.target
            if (el.tagName == 'TD') el = el.parentElement
            if (el.tagName == 'TABLE') return

            minInput.value = el.getAttribute('data-min')
            maxInput.value = el.getAttribute('data-max')
            resultText.innerText = el.getAttribute('data-result')
        }

        const generateNumber = function() {
            const min = +minInput.value
            const max = +maxInput.value
            const result = rand(min, max)

            resultText.innerText = result
            resultText.classList.remove('update-animation')
            resultText.offsetWidth
            resultText.classList.add('update-animation')

            prevResults.push({ min, max, result })
            localStorage.setItem(localStorageKey, JSON.stringify(prevResults.slice(-100)))
            renderPrevs()
        }

        const selectAll = function(event) {
            const el = event.target
            el.select()
        }

        renderPrevs()
        generateBtn.addEventListener('click', generateNumber)
        prevInputsList.addEventListener('click', loadResult)
        prevResultsList.addEventListener('click', loadResult)
        minInput.addEventListener('click', selectAll)
        maxInput.addEventListener('click', selectAll)
    </script>

</body>

</html>
